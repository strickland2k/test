# action.yml
name: QAEnv Tests
on: push
  # schedule:
  #   - cron: '0 8 1-31 * *'

jobs:

  install:
    runs-on: ubuntu-20.04
    # explicitly set the output of this job
    # so that other jobs can use it
    outputs:
      matrix: ${{ steps.prepare.outputs.matrix }}
    steps:
      # generate the list using a bash script
      - name: Create matrix âŠ¹
        id: prepare
        # for reusable workflow, must use the full action reference
        uses: bahmutov/gh-build-matrix@main
        with:
          n: 3 # number of containers to output

      - name: Print result ðŸ–¨
        run: echo '${{ steps.prepare.outputs.matrix }}'


  cypress-run:
    needs: install
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false
      matrix: ${{ fromJSON(needs.prepare.outputs.matrix) }}
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v3

      - name: Print GitHub variables ðŸ–¨
        run: npx @bahmutov/print-env GITHUB

      - name: Print GitHub strategy context ðŸ–¨
        run: echo '${{ toJSON(strategy) }}'

      - name: Run split Cypress tests ðŸ§ª
        # https://github.com/cypress-io/github-action
        uses: cypress-io/github-action@v5
        # using operating system process environment variables
        env:
          SPLIT: ${{ strategy.job-total }}
          SPLIT_INDEX: ${{ strategy.job-index }}

      # - name: Copy test execution videos
      #   working-directory: ui-test
      #   run: |
      #     mkdir public
      #     cp -r /__w/test/test/ui-test/cypress/videos/ public/videos/

      # - name: Merge test results into one
      #   working-directory: ui-test
      #   run: npm run report:merge

      # - name: Generate HTML report
      #   working-directory: ui-test
      #   run: npm run report:generate
        
      # - name: Get current date
      #   id: date
      #   run: echo "::set-output name=date::$(date +'%Y-%m-%d')"

      # - name: Deploy report page
      #   uses: peaceiris/actions-gh-pages@v3
      #   with:
      #     github_token: ${{ secrets.GITHUB_TOKEN }}
      #     publish_dir: /__w/test/test/ui-test/public
      #     destination_dir: qa/run-${{ steps.date.outputs.date }}/





